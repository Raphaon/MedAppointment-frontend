<div class="dashboard-shell">
  <aside class="dashboard-shell__sidebar">
    <div class="sidebar__brand">
      <div class="sidebar__logo" aria-hidden="true">ü©∫</div>
      <div class="sidebar__copy">
        <span class="sidebar__title">MedAppointment</span>
        <span class="sidebar__subtitle">Care orchestration</span>
      </div>
    </div>

    <nav class="sidebar__nav">
      <a
        *ngFor="let item of navigationItems"
        [routerLink]="item.route"
        routerLinkActive="active"
        class="sidebar__link">
        <mat-icon aria-hidden="true">{{ item.icon }}</mat-icon>
        <span>{{ item.label }}</span>
      </a>
    </nav>

    <div class="sidebar__footer">
      <p>Plateforme sant√© augment√©e pour √©quipes modernes.</p>
    </div>
  </aside>

  <div class="dashboard-shell__workspace">
    <header class="workspace__header">
      <div class="workspace__headline">
        <span class="workspace__kicker">{{ getTimeGreeting() }}</span>
        <h1><span aria-hidden="true">{{ getMoodEmoji() }}</span> Bonjour {{ currentUser?.firstName }}</h1>
        <p>{{ getWelcomeMessage() }}</p>
      </div>

      <div class="workspace__actions">
        <label class="workspace__search">
          <mat-icon aria-hidden="true">search</mat-icon>
          <input type="search" placeholder="Rechercher un patient, un dossier ou un rapport" />
        </label>
        <div class="workspace__buttons">
          <button mat-stroked-button color="primary" routerLink="/appointments/create">Nouveau rendez-vous</button>
          <app-notification-center></app-notification-center>
          <button mat-button class="profile-chip" [matMenuTriggerFor]="userMenu">
            <span class="profile-avatar">{{ getUserInitials() }}</span>
            <span class="profile-details">
              <span class="profile-name">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</span>
              <span class="profile-role">{{ getRoleLabel() }}</span>
            </span>
            <mat-icon aria-hidden="true">expand_more</mat-icon>
          </button>
        </div>
      </div>
    </header>

    <main class="workspace__content">
      <section class="summary-grid" *ngIf="summaryCards.length">
        <app-dashboard-card
          *ngFor="let card of summaryCards"
          [title]="card.title"
          [value]="card.value"
          [description]="card.description"
          [trendLabel]="card.trendLabel"
          [trendValue]="card.trendValue"
          [trendPositive]="card.trendPositive"
          [icon]="card.icon">
        </app-dashboard-card>
      </section>

      <section class="analytics-grid">
        <app-stats-chart
          *ngIf="consultationTrendChart"
          [type]="consultationTrendChart.type"
          [title]="consultationTrendChart.title"
          [subtitle]="consultationTrendChart.subtitle"
          [description]="consultationTrendChart.description"
          [labels]="consultationTrendChart.labels"
          [series]="consultationTrendChart.series"
          [primaryValue]="consultationTrendChart.primaryValue"
          [primaryLabel]="consultationTrendChart.primaryLabel">
        </app-stats-chart>

        <app-stats-chart
          *ngIf="statusChart"
          [type]="statusChart.type"
          [title]="statusChart.title"
          [subtitle]="statusChart.subtitle"
          [description]="statusChart.description"
          [labels]="statusChart.labels"
          [series]="statusChart.series"
          [primaryValue]="statusChart.primaryValue"
          [primaryLabel]="statusChart.primaryLabel">
        </app-stats-chart>

        <app-revenue-overview *ngIf="revenueOverview" [data]="revenueOverview"></app-revenue-overview>
      </section>

      <section class="appointments-grid">
        <app-recent-appointments
          class="appointments-grid__panel"
          title="Prochains rendez-vous"
          subtitle="Gardez une longueur d'avance sur vos consultations"
          [appointments]="appointmentView"
          [emptyState]="'Votre agenda est libre pour le moment'">
        </app-recent-appointments>

        <div class="quick-actions app-surface">
          <header>
            <p class="title">Actions rapides</p>
            <p class="subtitle">Priorisez vos t√¢ches cl√©s en un geste</p>
          </header>
          <div class="quick-actions__list">
            <a
              *ngFor="let action of primaryActions"
              class="quick-actions__item shadow-hover"
              [style.background-image]="action.accent"
              [routerLink]="action.route">
              <span class="emoji" aria-hidden="true">{{ action.emoji }}</span>
              <div>
                <p class="label">{{ action.label }}</p>
                <p class="description">{{ action.description }}</p>
              </div>
              <mat-icon aria-hidden="true">arrow_forward</mat-icon>
            </a>
          </div>
        </div>
      </section>

      <section *ngIf="currentUser?.role === UserRole.ADMIN && adminDoctorPerformance.length" class="admin-performance app-surface">
        <header class="admin-performance__header">
          <div>
            <p class="title">Top 10 m√©decins</p>
            <p class="subtitle">Classement dynamique par volume et pr√©sence</p>
          </div>
          <span class="badge badge--success">Mise √† jour continue</span>
        </header>
        <table class="table-clean">
          <thead>
            <tr>
              <th>M√©decin</th>
              <th>Sp√©cialit√©</th>
              <th>Consultations</th>
              <th>Taux pr√©sence</th>
              <th>Revenus g√©n√©r√©s</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let doctor of adminDoctorPerformance">
              <td>
                <div class="doctor-cell">
                  <span class="avatar" aria-hidden="true">üë©‚Äç‚öïÔ∏è</span>
                  <span>{{ doctor.name }}</span>
                </div>
              </td>
              <td>{{ doctor.specialty }}</td>
              <td>{{ doctor.consultations }}</td>
              <td>{{ doctor.presenceRate }}%</td>
              <td>{{ formatCurrency(doctor.revenue) }}</td>
            </tr>
          </tbody>
        </table>
      </section>
    </main>
  </div>
</div>

<mat-menu #userMenu="matMenu">
  <div class="user-info">
    <p class="user-name">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</p>
    <p class="user-role">{{ getRoleLabel() }}</p>
  </div>
  <mat-divider></mat-divider>
  <button mat-menu-item routerLink="/profile">
    <mat-icon aria-hidden="true">person</mat-icon>
    <span>Mon profil</span>
  </button>
  <button mat-menu-item (click)="logout()">
    <mat-icon aria-hidden="true">logout</mat-icon>
    <span>D√©connexion</span>
  </button>
</mat-menu>
